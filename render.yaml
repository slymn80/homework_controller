services:
  - type: web
    name: homework-controller-api
    env: docker
    plan: starter
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: OPENAI_API_KEY
        sync: false
      - key: GOOGLE_SERVICE_ACCOUNT_JSON
        value: creds/service_account.json
      - key: ALLOWED_EXT
        value: .txt,.docx,.pdf,.jpg,.jpeg,.png
      - key: OCR_LANG
        value: tur+eng
      - key: DRIVE_SOURCE_FOLDER_ID
        sync: false
      - key: DRIVE_REPORTS_FOLDER_ID
        sync: false
      - key: DRIVE_BACKUP_FOLDER_ID
        sync: false
      - key: LOCAL_OUTPUT_DIR
        value: outputs
      - key: REPORT_PREFIX
        value: grading-report
      - key: MAX_FILES_PER_RUN
        value: "0"
    disk:
      name: outputs-disk
      mountPath: /app/outputs
      sizeGB: 1

  # âœ… CRON yerine Worker tipi kullan (her zaman aktif veya Render Cron Job'la tetiklenebilir)
  - type: worker
    name: homework-controller-worker
    env: docker
    plan: starter
    autoDeploy: true
    envVars:
      - key: OPENAI_API_KEY
        sync: false
      - key: GOOGLE_SERVICE_ACCOUNT_JSON
        value: creds/service_account.json
      - key: ALLOWED_EXT
        value: .txt,.docx,.pdf,.jpg,.jpeg,.png
      - key: OCR_LANG
        value: tur+eng
      - key: DRIVE_SOURCE_FOLDER_ID
        sync: false
      - key: DRIVE_REPORTS_FOLDER_ID
        sync: false
      - key: DRIVE_BACKUP_FOLDER_ID
        sync: false
      - key: LOCAL_OUTPUT_DIR
        value: outputs
      - key: REPORT_PREFIX
        value: grading-report
      - key: MAX_FILES_PER_RUN
        value: "0"
    disk:
      name: outputs-disk
      mountPath: /app/outputs
      sizeGB: 1
    startCommand: "python -m src.main && sleep 31536000"
